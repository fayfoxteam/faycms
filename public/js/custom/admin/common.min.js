var common={"filebrowserImageUploadUrl":null,"filebrowserFlashUploadUrl":null,"dragsortKey":null,"validformParams":{"forms":{},"settings":{"poshytip":{"init":function(){system.getCss(system.url("css/tip-twitter/tip-twitter.css"));system.getScript(system.url("js/jquery.poshytip.min.js"))},"showAllErrors":true,"beforeSubmit":function(){$("body").block()},"onError":function(obj,msg,rule){var last=$.validform.getElementsByName(obj).last();last.poshytip("destroy");last.poshytip({"className":"tip-twitter","showOn":"none","alignTo":"target","alignX":"inner-right","offsetX":-60,"offsetY":5,"content":msg}).poshytip("show")},"onSuccess":function(obj){var last=$.validform.getElementsByName(obj).last();last.poshytip("destroy")}},"setting":{"init":function(){system.getCss(system.url("css/tip-twitter/tip-twitter.css"));system.getScript(system.url("js/jquery.poshytip.min.js"))},"ajaxSubmit":true,"beforeSubmit":function(){$("#setting-form-submit").nextAll("span").remove();$("#setting-form-submit").after('<img src="'+system.url("images/throbber.gif")+'" class="submit-loading" />')},"afterAjaxSubmit":function(resp){if(resp.status){$("#setting-form-submit").nextAll("img,span,a").remove();$("#setting-form-submit").after('<span class="fc-green" style="margin-left:6px;">保存成功，刷新页面后生效。</span><a href="javascript:window.location.reload();">点此刷新</a>')}else{alert(resp.message)}},"onError":function(obj,msg,rule){var last=$.validform.getElementsByName(obj).last();last.poshytip("destroy");last.poshytip({"className":"tip-twitter","showOn":"none","alignTo":"target","alignX":"inner-right","offsetX":-60,"offsetY":5,"content":msg}).poshytip("show")},"onSuccess":function(obj){var last=$.validform.getElementsByName(obj).last();last.poshytip("destroy")}}}},"settingValidform":null,"beforeDragsortListItemRemove":function(obj){},"afterDragsortListItemRemove":function(obj){},"fancybox":function(){if($(".fancybox-image").length){system.getCss(system.url("css/jquery.fancybox-1.3.4.css"));system.getScript(system.url("js/jquery.fancybox-1.3.4.pack.js"),function(){$(".fancybox-image").fancybox({"transitionIn":"elastic","transitionOut":"elastic","type":"image","padding":0,"centerOnScroll":true})})}if($(".fancybox-inline").length){system.getCss(system.url("css/jquery.fancybox-1.3.4.css"));system.getScript(system.url("js/jquery.fancybox-1.3.4.pack.js"),function(){$(".fancybox-inline").fancybox({"padding":0,"centerOnScroll":true,"onClosed":function(o){$($(o).attr("href")).find("input,select,textarea").each(function(){$(this).poshytip("hide")})},"type":"inline"})})}if($(".fancybox-iframe").length){system.getCss(system.url("css/jquery.fancybox-1.3.4.css"));system.getScript(system.url("js/jquery.fancybox-1.3.4.pack.js"),function(){$(".fancybox-iframe").fancybox({"centerOnScroll":true,"type":"iframe","width":750,"autoDimensions":true})})}if($(".fancybox-close").length){system.getCss(system.url("css/jquery.fancybox-1.3.4.css"));system.getScript(system.url("js/jquery.fancybox-1.3.4.pack.js"),function(){$(document).on("click",".fancybox-close",function(){$.fancybox.close()})})}},"notification":function(){$(document).on("click",".header-notification-mute",function(){$.ajax({type:"GET",url:system.url("admin/notification/mute"),dataType:"json",cache:false,success:function(data){common.headerNotification()}})});$(document).on("click",".header-notification-delete",function(){$.ajax({type:"GET",url:system.url("admin/notification/delete",{"id":$(this).attr("data-id")}),dataType:"json",cache:false,success:function(data){if(data.status==1){$("#header-notification-"+data.id).css("background-color","red").fadeOut()}else{alert(data.message)}common.headerNotification()}})})},"menu":function(){$("#main-menu").on("click",".has-sub > a",function(){if($(this).parent().parent().parent().hasClass("has-sub")||!$("#sidebar-menu").hasClass("collapsed")||$(window).width()<768||($.browser.msie&&$.browser.version=="8.0")){var slideElapse=300;$li=$(this).parent();$ul=$(this).next("ul");$_li=$ul.children("li");if($li.hasClass("expanded")){$ul.slideUp(slideElapse,function(){$li.removeClass("expanded").removeClass("opened");$(this).removeAttr("style")})}else{$ul.slideDown(slideElapse,function(){$(this).removeAttr("style")});$li.addClass("expanded");$_li.addClass("is-hidden");setTimeout((function($li){return function(){$li.addClass("is-shown")}})($_li),0);setTimeout((function($li){return function(){$li.removeClass("is-hidden is-shown")}})($_li),500);$li.siblings(".expanded").children("ul").slideUp(slideElapse,function(){$li.siblings(".expanded").removeClass("expanded").removeClass("opened");$(this).removeAttr("style")})}return false}});$(".toggle-mobile-menu").on("click",function(){$("#main-menu").toggleClass("mobile-is-visible")});$(".toggle-sidebar").on("click",function(){$("#sidebar-menu").toggleClass("collapsed");$(window).resize();$.ajax({type:"POST",url:system.url("admin/system/setting"),data:{"_key":"admin_sidebar_class","class":$("#sidebar-menu").hasClass("collapsed")?"collapsed":""}})})},"screenMeta":function(){if($(".screen-meta-links a").length){system.getCss(system.url("css/jquery.fancybox-1.3.4.css"));system.getScript(system.url("js/jquery.fancybox-1.3.4.pack.js"),function(){$(".screen-meta-links a").fancybox({"padding":0,"centerOnScroll":true,"titleShow":false,"onClosed":function(o){$($(o).attr("href")).find("input,select,textarea").each(function(){$(this).poshytip("hide")})},"type":"inline"})});$(".faycms-setting-link").on("mouseover",function(){$(this).addClass("fa-spin")}).on("mouseleave",function(){$(this).removeClass("fa-spin")})}},"dragsort":function(){if($(".dragsort").length){system.getScript(system.url("js/jquery.dragsort-0.5.1.js"),function(){$(".dragsort").dragsort({"itemSelector":"div.box","dragSelector":"h4","dragBetween":true,"placeHolderTemplate":'<div class="box"></div>',"dragSelectorExclude":"input,textarea,select,table,span,p","dragEnd":function(){if(common.dragsortKey){var data={"_key":common.dragsortKey};$(".dragsort").each(function(){var sort=[];$(this).find(".box").each(function(){if($(this).attr("data-name")){sort.push($(this).attr("data-name"))}});data[$(this).attr("id")]=sort});$.ajax({type:"POST",url:system.url("admin/system/setting"),data:data,dataType:"json",cache:false,success:function(resp){if(resp.status){}else{alert(resp.message)}}})}}})})}},"poshytip":function(){if($(".poshytip").length){system.getCss(system.url("css/tip-twitter/tip-twitter.css"));system.getScript(system.url("js/jquery.poshytip.min.js"),function(){$(".poshytip").poshytip({"className":"tip-twitter","alignTo":"target","alignX":"center","showTimeout":5})})}},"fixContent":function(){if($(".fixed-content").length){system.getScript(system.url("js/custom/fayfox.fixcontent.js"),function(){$(".fixed-content").fixcontent()})}},"events":function(){$(document).on("mouseenter",".box-title, .toggle-hover, .list-table tr",function(){$(this).addClass("hover")}).on("mouseleave",".box-title, .toggle-hover, .list-table tr",function(){$(this).removeClass("hover")});$(document).on("click",".box-title .toggle",function(){$(this).parent().parent().toggleClass("closed")});$(document).on("click",".box-title .remove",function(){var $box=$(this).parent().parent();$box.slideUp("normal",function(){$(this).remove()});var $setting_item=$("#setting-form input[name='boxes[]'][value='"+$box.attr("data-name")+"']");if($setting_item.length){$setting_item.attr("checked",false);$("#setting-form").submit()}});$(document).on("click",'a[id$="submit"]',function(){$("form#"+$(this).attr("id").replace("-submit","")).find('input[name="_export"]').remove();$("form#"+$(this).attr("id").replace("-submit","")).submit();return false});$(document).on("click",'a[id$="export"]',function(){$("form#"+$(this).attr("id").replace("-export","")).append('<input type="hidden" name="_export" value="1" />').submit();return false});$('a[id$="reset"]').click(function(){$("form#"+$(this).attr("id").replace("-reset",""))[0].reset()});$(".list-table").each(function(){$(this).find("tr:even").addClass("alternate")});$(document).on("click",".remove-link",function(){return confirm("确实要永久删除此记录吗？")});$(document).on("keydown",".pager .pager-input",function(event){if(event.keyCode==13||event.keyCode==108){var link=window.location.href;if(link.indexOf("?")>0){window.location.href=link+"&"+$(this).attr("name")+"="+$(this).val()}else{window.location.href=link+"?"+$(this).attr("name")+"="+$(this).val()}}})},"validform":function(){if($("form.validform").length){system.getScript(system.url("js/custom/fayfox.validform.min.js"),function(){if(!$.isEmptyObject(common.validformParams.forms)){for(var k in common.validformParams.forms){if(common.validformParams.forms[k].scene=="default"){var formId="form"}else{var formId=common.validformParams.forms[k].scene+"-form"}var settings=common.validformParams.settings[common.validformParams.forms[k].model];settings.init();common.validformParams.forms[k].obj=$("form#"+formId).validform(settings,common.validformParams.forms[k].rules,common.validformParams.forms[k].labels)}}var settings=common.validformParams.settings.poshytip;settings.init();$("form.validform").validform(settings)})}},"datepicker":function(){if($(".timepicker").length){system.getScript(system.url("js/My97DatePicker/WdatePicker.js"),function(){$(document).on("focus",".timepicker",function(){WdatePicker({"dateFmt":"yyyy-MM-dd HH:mm:ss"})})})}if($('.datetimepicker[name!="start_time"][name!="end_time"]').length){system.getCss(system.url("js/datetimepicker/jquery.datetimepicker.css"));system.getScript(system.url("js/datetimepicker/jquery.datetimepicker.js"),function(){$(".datetimepicker").datetimepicker({"lang":"ch","format":"Y-m-d H:i:00","formatDate":"Y-m-d","formatTime":"H:i","dayOfWeekStart":1,"allowBlank":$.browser.msie?false:true,"onShow":function(){setTimeout((function(o){return function(){var top=parseInt($(o).css("top"));if(top){$(o).css("top",top+2)}}})(this),20)}})})}if($('input.datetimepicker[name="start_time"]').length){system.getCss(system.url("js/datetimepicker/jquery.datetimepicker.css"));system.getScript(system.url("js/datetimepicker/jquery.datetimepicker.js"),function(){$('input.datetimepicker[name="start_time"]').datetimepicker({"lang":"ch","format":"Y-m-d H:i:00","formatDate":"Y-m-d","formatTime":"H:i","dayOfWeekStart":1,"allowBlank":($.browser.msie&&$.browser.version<9)?false:true,"onShow":function(ct){setTimeout((function(o){return function(){var top=parseInt($(o).css("top"));if(top){$(o).css("top",top+2)}}})(this),20);var end_time=$(this).parent().find('input.datetimepicker[name="end_time"]').val();if(end_time){this.setOptions({maxDate:end_time.split(" ")[0],maxTime:false})}}})})}if($('input.datetimepicker[name="end_time"]').length){system.getCss(system.url("js/datetimepicker/jquery.datetimepicker.css"));system.getScript(system.url("js/datetimepicker/jquery.datetimepicker.js"),function(){$('input.datetimepicker[name="end_time"]').datetimepicker({"lang":"ch","format":"Y-m-d H:i:00","formatDate":"Y-m-d","formatTime":"H:i","dayOfWeekStart":1,"allowBlank":($.browser.msie&&$.browser.version<9)?false:true,"onShow":function(ct){setTimeout((function(o){return function(){var top=parseInt($(o).css("top"));if(top){$(o).css("top",top+2)}}})(this),20);var start_time=$(this).parent().find('input.datetimepicker[name="start_time"]').val();if(start_time){this.setOptions({minDate:start_time.split(" ")[0],maxTime:false})}}})})}},"visualEditor":function(){if($("#visual-editor").length){window.CKEDITOR_BASEPATH=system.url("js/ckeditor/");system.getScript(system.url("js/ckeditor/ckeditor.js"),function(){CKEDITOR.on("dialogDefinition",function(ev){var dialogName=ev.data.name;var dialogDefinition=ev.data.definition;if(dialogName=="table"){var info=dialogDefinition.getContents("info");info.get("txtWidth")["default"]="";info.get("txtBorder")["default"]="";info.get("txtCellSpace")["default"]="";info.get("txtCellPad")["default"]="";info.get("txtCols")["default"]="3";info.get("selHeaders")["default"]="row"}});var config={"height":$("#visual-editor").height()};if(common.filebrowserImageUploadUrl){config.filebrowserImageUploadUrl=common.filebrowserImageUploadUrl}if(common.filebrowserFlashUploadUrl){config.filebrowserFlashUploadUrl=common.filebrowserFlashUploadUrl}if($("#visual-editor").hasClass("visual-simple")||parseInt($(window).width())<743){config.toolbar=[["Source"],["TextColor","BGColor"],["Bold","Italic","Underline","Strike","Subscript","Superscript","-","RemoveFormat"],["Image","Table"]];config.enterMode=CKEDITOR.ENTER_BR;config.shiftEnterMode=CKEDITOR.ENTER_P}common.editorObj=CKEDITOR.replace("visual-editor",config)})}},"markdownEditor":function(){if($("#wmd-input").length){system.getCss(system.url("css/pagedown.css"));system.getScript(system.url("js/markdown/Markdown.Converter.js"),function(){system.getScript(system.url("js/markdown/Markdown.Sanitizer.js"),function(){system.getScript(system.url("js/markdown/Markdown.Editor.js"),function(){system.getScript(system.url("js/markdown/Markdown.Extra.js"),function(){system.getScript(system.url("js/prettify.js"),function(){$("#wmd-input").wrap('<div class="wmd-panel"></div>').before(['<div id="wmd-button-bar">','<div id="wmd-model-links">','<a href="javascript:;" id="wmd-edit-model">编辑模式</a>','<a href="javascript:;" id="wmd-live-model">实况模式</a>','<a href="javascript:;" id="wmd-preview-model">预览模式</a>',"</div>","</div>"].join("")).addClass("fl").parent().after('<div id="wmd-preview" class="wmd-preview h350"></div>');$("#wmd-button-bar").on("click","#wmd-edit-model",function(){$("#wmd-input").show().css("width","98.9%");$("#wmd-preview").hide()}).on("click","#wmd-live-model",function(){$("#wmd-input").show().css("width","49%");$("#wmd-preview").show().css("width","48.7%")}).on("click","#wmd-preview-model",function(){$("#wmd-input").hide();$("#wmd-preview").show().css("width","98.9%")});var converter=new Markdown.Converter();Markdown.Extra.init(converter,{highlighter:"prettify"});var options={strings:{bold:"加粗 <strong> Ctrl+B",boldexample:"加粗文字",italic:"斜体 <em> Ctrl+I",italicexample:"斜体文字",link:"链接 <a> Ctrl+L",linkdescription:"请输入链接描述",quote:"引用 <blockquote> Ctrl+Q",quoteexample:"引用文字",code:"代码 <pre><code> Ctrl+K",codeexample:"请输入代码",image:"图片 <img> Ctrl+G",imagedescription:"请输入图片描述",olist:"数字列表 <ol> Ctrl+O",ulist:"普通列表 <ul> Ctrl+U",litem:"列表项目",heading:"标题 <h1>/<h2> Ctrl+H",headingexample:"标题文字",hr:"分割线 <hr> Ctrl+R",more:"摘要分割线 <!--more--> Ctrl+M",undo:"撤销 - Ctrl+Z",redo:"重做 - Ctrl+Y",redomac:"重做 - Ctrl+Shift+Z",fullscreen:"全屏 - Ctrl+J",exitFullscreen:"退出全屏 - Ctrl+E",fullscreenUnsupport:"此浏览器不支持全屏操作",imagedialog:"<p><b>插入图片</b></p><p>请在下方的输入框内输入要插入的远程图片地址</p><p>您也可以使用附件功能插入上传的本地图片</p>",linkdialog:"<p><b>插入链接</b></p><p>请在下方的输入框内输入要插入的链接地址</p>",ok:"确定",cancel:"取消",help:"Markdown语法帮助"}};common.editorObj=new Markdown.Editor(converter,"",options);common.editorObj.hooks.chain("onPreviewRefresh",prettyPrint);common.editorObj.run()})})})})})}},"removeEditor":function(){common.editorObj.destroy()},"tab":function(){$(".tabbable").each(function(){$(this).find(".tab-content div.tab-pane:gt(0)").hide()});$(document).on("click",".tabbable .nav-tabs a",function(){$($(this).attr("href")).show().siblings().hide();$(this).parent().addClass("active").siblings().removeClass("active");return false})},"showPager":function(id,pager){if(pager.total_pages>1){var html=['<span class="summary">',pager.total_records,"条记录</span>"];if(pager.current_page==1){html.push('<a href="javascript:;" title="首页" class="page-numbers first disabled">&laquo;</a>');html.push('<a href="javascript:;" title="上一页" class="page-numbers prev disabled">&lsaquo;</a>')}else{html.push('<a href="javascript:;" title="首页" class="page-numbers first" data-page="1">&laquo;</a>');html.push('<a href="javascript:;" title="上一页" class="page-numbers prev" data-page="'+(pager.current_page-1)+'">&lsaquo;</a>')}html.push(' 第 <input type="number" value="'+pager.current_page+'" class="form-control pager-input" min="1" max="'+pager.total_pages+'" /> 页，共'+pager.total_pages+"页");if(pager.current_page==pager.total_pages){html.push('<a href="javascript:;" title="下一页" class="page-numbers prev disabled">&rsaquo;</a>');html.push('<a href="javascript:;" title="末页" class="page-numbers first disabled">&raquo;</a>')}else{html.push('<a href="javascript:;" title="下一页" class="page-numbers prev" data-page="'+(pager.current_page+1)+'">&rsaquo;</a>');html.push('<a href="javascript:;" title="末页" class="page-numbers first" data-page="'+pager.total_pages+'">&raquo;</a>')}}else{var html=['<span class="summary">',pager.total_records,"条记录</span>"]}$("#"+id).html(html.join(""))},"batch":function(){$(document).on("change",".batch-ids-all",function(){$(".batch-ids,.batch-ids-all").attr("checked",!!$(this).attr("checked"))}).on("submit","#batch-form",function(){if($('[name="batch_action"]').val()==""&&$('[name="batch_action_2"]').val()==""){alert("请选择操作");return false}else{$(".wrapper").block()}}).on("click","#batch-form-submit-2",function(){$("#batch-form-submit").click()})},"dragsortList":function(){if($(".dragsort-list").length){system.getScript(system.url("js/jquery.dragsort-0.5.1.js"),function(){$(".dragsort-list").dragsort({"itemSelector":"div.dragsort-item","dragSelector":".dragsort-item-selector","placeHolderTemplate":'<div class="dragsort-item holder"></div>'})});$(".dragsort-list").on("click",".dragsort-rm",function(){$(this).parent().fadeOut("fast",function(){var dragsort_list=$(this).parent();common.beforeDragsortListItemRemove($(this));$(this).remove();common.afterDragsortListItemRemove(dragsort_list)})})}},"textAutosize":function(){if($("textarea.autosize").length){system.getScript(system.url("js/jquery.autosize.min.js"),function(){$("textarea.autosize").autosize()})}},"dropdown":function(){$(document).on("click","a.dropdown",function(){$(this).parent().toggleClass("open");return false});$(document).on("click",function(){$(".dropdown-container").each(function(){if($(this).hasClass("open")){$(this).removeClass("open")}})})},"init":function(){this.fancybox();this.menu();this.screenMeta();this.dragsort();this.poshytip();this.datepicker();this.events();this.fixContent();this.validform();this.visualEditor();this.markdownEditor();this.tab();this.batch();this.dragsortList();this.textAutosize();this.dropdown()}};